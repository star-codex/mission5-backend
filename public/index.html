<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Mission 5 App</title>
		<link rel="stylesheet" type="text/css" href="style.css" />
	</head>
	<body>
		<form id="messageForm">
			<label for="message">Enter your message:</label>
			<input type="text" id="message" name="message" required />
			<button type="submit">Submit</button>
		</form>

		<button id="fetchButton">Fetch Messages</button>

		<div id="messages"></div>
		<script>
			if (typeof document !== 'undefined') {
				document.addEventListener('DOMContentLoaded', function () {
					const messageForm = document.getElementById('messageForm');
					const fetchButton = document.getElementById('fetchButton');
					const messagesContainer = document.getElementById('messages');

					messageForm.addEventListener('submit', async function (event) {
						event.preventDefault();

						const messageInput = document.getElementById('message');
						const message = messageInput.value;

						try {
							// Send a POST request to submit the message
							await fetch('/submit', {
								method: 'POST',
								headers: {
									'Content-Type': 'application/json',
								},
								body: JSON.stringify({ message }),
							});

							// Clear the input field
							messageInput.value = '';

							// Fetch and display all messages after submitting
							fetchMessages();
						} catch (error) {
							console.error('Error submitting message:', error);
						}
					});

					fetchButton.addEventListener('click', function () {
						// Fetch and display all messages
						fetchMessages();
					});

					async function fetchMessages() {
						try {
							// Send a GET request to fetch all messages
							const response = await fetch('/fetch');
							const messages = await response.json();

							// Display the messages
							displayMessages(messages);
						} catch (error) {
							console.error('Error fetching messages:', error);
						}
					}

					function displayMessages(messages) {
						// Clear the existing messages
						messagesContainer.innerHTML = '';

						// Display each message in a new paragraph
						messages.forEach((message) => {
							const messageParagraph = document.createElement('p');
							messageParagraph.textContent = message.message;
							messagesContainer.appendChild(messageParagraph);
						});
					}
				});
			}
		</script>
	</body>
</html>
